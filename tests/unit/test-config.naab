// Unit tests for config_manager.naab module
use io
use json
use array

main {
    io.write("  [TEST] Config Manager Unit Tests\n")

    let pass_count = 0
    let fail_count = 0

    // Test 1: Profile loading
    try {
        io.write("    Test 1: Profile loading... ")
        
        let profile = {
            "name": "balanced",
            "opt_level": "O2",
            "simd": true,
            "lto": false
        }
        
        if profile["name"] == "balanced" {
            io.write("✓ PASS\n")
            pass_count = pass_count + 1
        } else {
            io.write("✗ FAIL\n")
            fail_count = fail_count + 1
        }
    } catch (e) {
        io.write("✗ FAIL (exception: ", e, ")\n")
        fail_count = fail_count + 1
    }

    // Test 2: Environment variable resolution
    try {
        io.write("    Test 2: Environment variables... ")
        
        let config = {
            "output_dir": "${PIVOT_OUTPUT}",
            "profile": "${PIVOT_PROFILE}"
        }
        
        if config["output_dir"] != "" {
            io.write("✓ PASS\n")
            pass_count = pass_count + 1
        } else {
            io.write("✗ FAIL\n")
            fail_count = fail_count + 1
        }
    } catch (e) {
        io.write("✗ FAIL (exception: ", e, ")\n")
        fail_count = fail_count + 1
    }

    // Summary
    io.write("\n  ═══════════════════════════════════════════════\n")
    io.write("  Total: ", (pass_count + fail_count), " | Pass: ", pass_count, " | Fail: ", fail_count, "\n")
    io.write("  ═══════════════════════════════════════════════\n")

    if fail_count > 0 {
        throw "Tests failed"
    }
}
